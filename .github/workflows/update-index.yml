name: Update index.html

on:
  push:
    paths:
      - 'usr_upload/**'

jobs:
  update-index:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: List files in usr_upload
      id: list-files
      run: |
        FILES=$(ls -1 usr_upload)
        echo "::set-output name=files::${FILES}"

    - name: Update index.html
      run: |
        echo "<!DOCTYPE html>" > index.html
        echo "<html lang='en'>" >> index.html
        echo "<head>" >> index.html
        echo "  <meta charset='UTF-8'>" >> index.html
        echo "  <meta name='viewport' content='width=device-width, initial-scale=1.0'>" >> index.html
        echo "  <title>Uploaded Files</title>" >> index.html
        echo "</head>" >> index.html
        echo "<body>" >> index.html
        echo "  <h1>Uploaded Files</h1>" >> index.html
        echo "  <ul>" >> index.html
        for file in ${{ steps.list-files.outputs.files }}; do
          echo "    <li><a href='usr_upload/$file'>$file</a></li>" >> index.html
        done
        echo "  </ul>" >> index.html
        echo "</body>" >> index.html
        echo "</html>" >> index.html

    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add index.html
        git commit -m "Automatically updated index.html with new files"
        git push
